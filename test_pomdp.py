from mdp import *

def test_pomdp_value_iteration():
    t_prob = [
        [#up
            [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],#1 
            [0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],#2
            [0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],#3
            [0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],#4
            [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],#5
            [0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],#6
            [0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],#7
            [0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0],#8
            [0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0],#9
            [0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0],#10
            [0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0],#11
            [0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0],#12
            [0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0],#13
            [0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0],#14
            [0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0],#15
            [0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0],#16
            [0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0],#17
            [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0],#18
            [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0],#19
            [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0],#20
        ],                
        [#right
            [0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],#1 
            [0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],#2
            [0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],#3
            [0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],#4
            [0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],#5
            [0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0],#6
            [0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0],#7
            [0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0],#8
            [0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0],#9
            [0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0],#10
            [0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0],#11
            [0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0],#12
            [0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0],#13
            [0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0],#14
            [0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0],#15
            [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0],#16
            [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0],#17
            [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0],#18
            [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],#19
            [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],#20
        ],                
        [#down
            [0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],#1 
            [0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],#2
            [0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],#3
            [0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0],#4
            [0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0],#5
            [0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0],#6
            [0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0],#7
            [0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0],#8
            [0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0],#9
            [0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0],#10
            [0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0],#11
            [0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0],#12
            [0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0],#13
            [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0],#14
            [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0],#15
            [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],#16
            [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0],#17
            [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0],#18
            [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0],#19
            [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],#20
        ],                
        [#left
            [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],#1 
            [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],#2
            [0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],#3
            [0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],#4
            [0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],#5
            [0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0],#6
            [0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0],#7
            [0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0],#8
            [0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0],#9
            [0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0],#10
            [0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0],#11
            [0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0],#12
            [0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0],#13
            [0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0],#14
            [0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0],#15
            [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0],#16
            [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0],#17
            [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0],#18
            [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0],#19
            [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0],#20
        ]
    ]
    e_prob = [
        [#up

        ],
        [#right

        ],
        [#down

        ],
        [#left

        ],
    ]
    rewards = [[5, -10], [-20, 5], [-1, -1]]

    gamma = 0.95
    actions = ('0', '1', '2', '3')
    states = ('0', '1', '2', '3', '4', '5', '6', '7', '8', '9', '10', '11', '12', '13', '14', 
        '15', '16', '17', '18', '19', )

    pomdp = POMDP(actions, t_prob, e_prob, rewards, states, gamma)
    utility = pomdp_value_iteration(pomdp, epsilon=5)
    
    for _, v in utility.items():
        sum_ = 0
        for element in v:
            sum_ += sum(element)
    assert -9.76 < sum_ < -9.70 or 246.5 < sum_ < 248.5 or 0 < sum_ < 1

test_pomdp_value_iteration()